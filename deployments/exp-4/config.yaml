---
# exp-4: PHASE Feedback Engine Evaluation
# Tests whether PHASE-generated feedback configs reduce SUP detectability.
#
# Same SUP configurations as exp-3, but with PHASE feedback configs applied.
# Each version gets feedback from its matching training dataset:
#   Version 2 (summer24 calibration) → feedback from exp3_axes-summer24
#   Version 3 (fall24 calibration)   → feedback from exp3_axes-fall24
#   Version 4 (spring25 calibration) → feedback from exp3_axes-spring25
#   Version 0/1 (baseline, no timing) → feedback from exp3_axes-fall24 (default)
#
# Comparison:
#   exp-3 B3.gemma (no feedback) vs exp-4 B3.gemma (with feedback)
#   → Measures feedback engine's impact on detectability
#
# Feedback configs adjust:
#   - Workflow selection weights (all brains)
#   - Page dwell time & navigation clicks (MCHP BrowseWeb)
#   - Site/task selection weights (MCHP + BrowserUse)
#   - LLM prompt augmentation (BrowserUse + SmolAgents)
#
# Total VMs: 25 (9 non-GPU, 16 v100) — same as exp-3

deployment_name: exp-4

# PHASE feedback config source directories (on control node)
# These are generated by: cd ~/PHASE/feedback_engine && poetry run python FEEDBACK_ENGINE.py
feedback_sources:
  summer24: "~/PHASE/feedback_engine/configs/exp3_axes-summer24"
  fall24: "~/PHASE/feedback_engine/configs/exp3_axes-fall24"
  spring25: "~/PHASE/feedback_engine/configs/exp3_axes-spring25"

# Default feedback source for baselines (version 1) that have no calibration target
feedback_default: fall24

# Map version number to feedback source
feedback_map:
  0: fall24      # B/S baselines get fall24 feedback (largest dataset)
  1: fall24      # MCHP baseline gets fall24 feedback (largest dataset)
  2: summer24
  3: fall24
  4: spring25

flavor_capacity:
  v1.14vcpu.28g: 9
  v100-1gpu.14vcpu.28g: 19

deployments:
  # === Controls (5) - non-GPU, no feedback ===
  - behavior: C0
    flavor: v1.14vcpu.28g
    count: 3
  - behavior: M0
    flavor: v1.14vcpu.28g
    count: 2

  # === MCHP (4) - non-GPU, no LLM ===
  - behavior: M1
    flavor: v1.14vcpu.28g
    count: 1
  - behavior: M2
    flavor: v1.14vcpu.28g
    count: 1
  - behavior: M3
    flavor: v1.14vcpu.28g
    count: 1
  - behavior: M4
    flavor: v1.14vcpu.28g
    count: 1

  # === BrowserUse (8) - all v100 ===
  - behavior: B0.llama
    flavor: v100-1gpu.14vcpu.28g
    count: 1
  - behavior: B0.gemma
    flavor: v100-1gpu.14vcpu.28g
    count: 1
  - behavior: B2.llama
    flavor: v100-1gpu.14vcpu.28g
    count: 1
  - behavior: B2.gemma
    flavor: v100-1gpu.14vcpu.28g
    count: 1
  - behavior: B3.llama
    flavor: v100-1gpu.14vcpu.28g
    count: 1
  - behavior: B3.gemma
    flavor: v100-1gpu.14vcpu.28g
    count: 1
  - behavior: B4.llama
    flavor: v100-1gpu.14vcpu.28g
    count: 1
  - behavior: B4.gemma
    flavor: v100-1gpu.14vcpu.28g
    count: 1

  # === SmolAgents (8) - all v100 ===
  - behavior: S0.llama
    flavor: v100-1gpu.14vcpu.28g
    count: 1
  - behavior: S0.gemma
    flavor: v100-1gpu.14vcpu.28g
    count: 1
  - behavior: S2.llama
    flavor: v100-1gpu.14vcpu.28g
    count: 1
  - behavior: S2.gemma
    flavor: v100-1gpu.14vcpu.28g
    count: 1
  - behavior: S3.llama
    flavor: v100-1gpu.14vcpu.28g
    count: 1
  - behavior: S3.gemma
    flavor: v100-1gpu.14vcpu.28g
    count: 1
  - behavior: S4.llama
    flavor: v100-1gpu.14vcpu.28g
    count: 1
  - behavior: S4.gemma
    flavor: v100-1gpu.14vcpu.28g
    count: 1
